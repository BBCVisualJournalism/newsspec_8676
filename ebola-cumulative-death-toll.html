<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="content-language" content="en" />
<meta http-equiv="Content-Type" content="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
</head>
<body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript" src="js/csv.js"></script>
<script>

    $.ajax({
        url: 'http://www.test.bbc.co.uk/indepthtoolkit/data_set/ebola-cumulative-death-toll',
        //url: 'http://pal.sandbox.dev.bbc.co.uk/indepthtoolkit/data_set/dataset-house-prices',
        dataType: 'jsonp',
        jsonpCallback: 'loadChartData'
    });

    function makeNullIfEmptyString (value) {
        if (value == '') {
            return null;
        }
        return value;
    }

    function convertDataSetEmptyStringsToZero (data) {
        for (var i = 0, len = data.length; i < len; i++) {
            data[i][1] = makeNullIfEmptyString(data[i][1]);
            data[i][2] = makeNullIfEmptyString(data[i][2]);
            data[i][3] = makeNullIfEmptyString(data[i][3]);
            data[i][4] = makeNullIfEmptyString(data[i][4]);
            data[i][5] = makeNullIfEmptyString(data[i][5]);
        }
        return data;
    }

    function loadChartData(blob) {

        var data = CSV.parse(blob);

        data = convertDataSetEmptyStringsToZero(data);

        google.load('visualization', '1.0', {
            'packages': ['corechart'],
            'callback': function () {
                
                // Create the data table.
                // data = [
                //     ['23/03/2014',29,,,,29],
                //     ['24/03/2014',59,,,,59],
                //     ['25/03/2014',60,,,,60],
                //     ['26/03/2014',62,,,,62],
                //     ['27/03/2014',66,6,,,72],
                //     ['28/03/2014',66,6,,,72],
                //     ['29/03/2014',66,6,,,72],
                //     ['30/03/2014',70,2,,,72],
                //     ['31/03/2014',70,2,,,72],
                //     ['01/04/2014',70,2,,,72],
                //     ['02/04/2014',83,2,,,85],
                //     ['03/04/2014',83,2,,,85],
                //     ['04/04/2014',83,2,,,85],
                //     ['05/04/2014',86,7,,,93],
                //     ['06/04/2014',86,7,,,93],
                //     ['07/04/2014',95,10,,,105],
                //     ['08/04/2014',95,10,,,105],
                //     ['09/04/2014',95,10,,,105],
                //     ['10/04/2014',101,10,,,111],
                //     ['11/04/2014',101,10,,,111],
                //     ['12/04/2014',101,10,,,111],
                //     ['13/04/2014',101,10,,,111],
                //     ['14/04/2014',101,10,,,111],
                //     ['15/04/2014',101,10,,,111],
                //     ['16/04/2014',101,10,,,111],
                //     ['17/04/2014',122,13,,,135],
                //     ['18/04/2014',122,13,,,135],
                //     ['19/04/2014',122,13,,,135],
                //     ['20/04/2014',122,13,,,135],
                //     ['21/04/2014',122,13,,,135],
                //     ['22/04/2014',122,13,,,135],
                //     ['23/04/2014',122,13,,,135],
                //     ['24/04/2014',122,13,,,135],
                //     ['25/04/2014',122,13,,,135],
                //     ['26/04/2014',122,13,,,135],
                //     ['27/04/2014',122,13,,,135],
                //     ['28/04/2014',122,13,,,135],
                //     ['29/04/2014',122,13,,,135],
                //     ['30/04/2014',122,13,,,135],
                //     ['01/05/2014',122,13,,,135],
                //     ['02/05/2014',122,13,,,135],
                //     ['03/05/2014',122,13,,,135],
                //     ['04/05/2014',122,13,,,135],
                //     ['05/05/2014',122,13,,,135],
                //     ['06/05/2014',155,13,,,168],
                //     ['07/05/2014',155,13,,,168],
                //     ['08/05/2014',155,13,,,168],
                //     ['09/05/2014',158,13,,,171],
                //     ['10/05/2014',158,13,,,171],
                //     ['11/05/2014',158,13,,,171],
                //     ['12/05/2014',158,13,,,171],
                //     ['13/05/2014',158,13,,,171],
                //     ['14/05/2014',158,13,,,171],
                //     ['15/05/2014',171,13,,,184],
                //     ['16/05/2014',171,13,,,184],
                //     ['17/05/2014',171,13,,,184],
                //     ['18/05/2014',171,13,,,184],
                //     ['19/05/2014',171,13,,,184],
                //     ['20/05/2014',171,13,,,184],
                //     ['21/05/2014',171,13,,,184],
                //     ['22/05/2014',171,13,,,184],
                //     ['23/05/2014',171,13,,,184],
                //     ['24/05/2014',171,13,,,184],
                //     ['25/05/2014',171,13,,,184],
                //     ['26/05/2014',171,13,,,184],
                //     ['27/05/2014',171,13,,,184],
                //     ['28/05/2014',186,13,,5,204],
                //     ['29/05/2014',186,13,,5,204],
                //     ['30/05/2014',193,13,,6,212],
                //     ['31/05/2014',193,13,,6,212],
                //     ['01/06/2014',193,13,,6,212],
                //     ['02/06/2014',193,13,,6,212],
                //     ['03/06/2014',193,13,,6,212],
                //     ['04/06/2014',208,13,,6,227],
                //     ['05/06/2014',208,13,,6,227],
                //     ['06/06/2014',215,13,,6,234],
                //     ['07/06/2014',215,13,,6,234],
                //     ['08/06/2014',215,13,,6,234],
                //     ['09/06/2014',215,13,,6,234],
                //     ['10/06/2014',226,13,,7,246],
                //     ['11/06/2014',226,13,,7,246],
                //     ['12/06/2014',226,13,,7,246],
                //     ['13/06/2014',226,13,,7,246],
                //     ['14/06/2014',226,13,,7,246],
                //     ['15/06/2014',226,13,,7,246],
                //     ['16/06/2014',226,13,,7,246],
                //     ['17/06/2014',226,13,,7,246],
                //     ['18/06/2014',264,24,,49,337],
                //     ['19/06/2014',264,24,,49,337],
                //     ['20/06/2014',264,24,,49,337],
                //     ['21/06/2014',264,24,,49,337],
                //     ['22/06/2014',264,24,,49,337],
                //     ['23/06/2014',264,24,,49,337],
                //     ['24/06/2014',270,34,,34,338],
                //     ['25/06/2014',270,34,,34,338],
                //     ['26/06/2014',270,34,,34,338],
                //     ['27/06/2014',270,34,,34,338],
                //     ['28/06/2014',270,34,,34,338],
                //     ['29/06/2014',270,34,,34,338],
                //     ['30/06/2014',270,34,,34,338],
                //     ['01/07/2014',303,65,,99,467],
                //     ['02/07/2014',303,65,,99,467],
                //     ['03/07/2014',305,75,,101,481],
                //     ['04/07/2014',305,75,,101,481],
                //     ['05/07/2014',305,75,,101,481],
                //     ['06/07/2014',305,75,,101,481],
                //     ['07/07/2014',305,75,,101,481],
                //     ['08/07/2014',307,84,,127,518],
                //     ['09/07/2014',307,84,,127,518],
                //     ['10/07/2014',309,88,,142,539],
                //     ['11/07/2014',309,88,,142,539],
                //     ['12/07/2014',309,88,,142,539],
                //     ['13/07/2014',309,88,,142,539],
                //     ['14/07/2014',309,88,,142,539],
                //     ['15/07/2014',309,88,,142,539],
                //     ['16/07/2014',309,88,,142,539],
                //     ['17/07/2014',310,106,,197,613],
                //     ['18/07/2014',310,106,,197,613],
                //     ['19/07/2014',310,116,,206,632],
                //     ['20/07/2014',310,116,,206,632],
                //     ['21/07/2014',310,116,,206,632],
                //     ['22/07/2014',310,116,,206,632],
                //     ['23/07/2014',310,116,,206,632],
                //     ['24/07/2014',314,127,,219,660],
                //     ['25/07/2014',314,127,,219,660],
                //     ['26/07/2014',314,127,,219,660],
                //     ['27/07/2014',319,129,,224,672],
                //     ['28/07/2014',319,129,,224,672],
                //     ['29/07/2014',319,129,,224,672],
                //     ['30/07/2014',319,129,,224,672],
                //     ['31/07/2014',339,156,1,233,729],
                //     ['01/08/2014',339,156,1,233,729],
                //     ['02/08/2014',339,156,1,233,729],
                //     ['03/08/2014',339,156,1,233,729],
                //     ['04/08/2014',358,255,1,273,887],
                //     ['05/08/2014',358,255,1,273,887],
                //     ['06/08/2014',363,282,1,286,932],
                //     ['07/08/2014',363,282,1,286,932],
                //     ['08/08/2014',367,294,2,298,961],
                //     ['09/08/2014',373,323,2,315,1013],
                //     ['11/08/2014',377,355,3,334,1069],
                //     ['13/08/2014',380,413,4,348,1145],
                //     ['16/08/2014',394,466,4,365,1229],
                //     ['18/08/2014',396,576,4,374,1350]
                // ];

                var dataTable = new google.visualization.DataTable();
                dataTable.addColumn('string', 'Date');
                dataTable.addColumn('number', 'Guinea');
                dataTable.addColumn('number', 'Liberia');
                dataTable.addColumn('number', 'Nigeria');
                dataTable.addColumn('number', 'Sierra Leone');
                dataTable.addColumn('number', 'Total');
                data.shift();
                dataTable.addRows(data);
                
                var view = new google.visualization.DataView(dataTable);
                view.setColumns([{
                    type: 'date',
                    calc: function(table, row) {
                        var stringDate = table.getValue(row, 0);
                        var dateComponents = stringDate.split('/');
                        return new Date(parseInt(dateComponents[2]), parseInt(dateComponents[1]), parseInt(dateComponents[0]));
                    }
                }, 1, 2, 3, 4, 5]);

                // Set chart options
                var options = {
                    // enableInteractivity: false,
                    width:  976,
                    height: 500,
                    chartArea: {
                        backgroundColor: {
                            strokeWidth: 1,
                            stroke: '#efefef'
                        }
                    },
                    hAxis: {
                        format: "dd MMM",
                        gridlines: {
                            color: '#efefef',
                            count: 8
                        }
                    },
                    vAxis: {
                        maxValue: 400
                    },
                    legend: {
                        position:         'bottom',
                        labeledValueText: 'both'
                    },
                    series: {}
                };
                
                for (var i = 1; i < dataTable.getNumberOfColumns(); i++) {
                    options.series[i - 1] = {
                        labelInLegend: dataTable.getColumnLabel(i) + ': ' + dataTable.getFormattedValue(dataTable.getNumberOfRows() - 1, i)
                    };
                }
                
                // Instantiate and draw our chart, passing in some options.
                var chart = new google.visualization.LineChart(document.body);
                chart.draw(view, options);
                
            }
        });
    }

</script>
</body>
</html>